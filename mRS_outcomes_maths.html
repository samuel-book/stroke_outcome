
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Mathematics for calculating odds and probabilities of mRS-level outcomes after stroke, based on time to reperfusion treatment &#8212; Stroke outcome modelling</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Example output from stroke outcome model" href="demo_of_outcome_model.html" />
    <link rel="prev" title="Defining modified Rankin Scale (mRS) probability distributions for untreated patients, and predicted distributions if treatment given at time of stroke onset" href="mRS_datasets_full.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Stroke outcome modelling</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Predicting disability outcomes and utility after treatment of stroke with thrombolysis (IVT) or thrombectomy (MT)
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="mRS_datasets_full.html">
   Defining modified Rankin Scale (mRS) probability distributions for untreated patients, and predicted distributions if treatment given at time of stroke onset
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Mathematics for calculating odds and probabilities of mRS-level outcomes after stroke, based on time to reperfusion treatment
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="demo_of_outcome_model.html">
   Example output from stroke outcome model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="matrix.html">
   Demonstration of added utility depending on time to IVT and MT
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="show_outcome_model_code.html">
   Show outcome model python code
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="proportion_ischaemic_with_lvo.html">
   Proportion of ischaemic patients with LVO
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="_sources/mRS_outcomes_maths.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Mathematics for calculating odds and probabilities of mRS-level outcomes after stroke, based on time to reperfusion treatment
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#modified-rankin-scale">
     Modified Rankin Scale
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#reperfusion-treatment-for-ischaemic-stroke">
     Reperfusion treatment for ischaemic stroke
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#decay-of-effect-of-reperfusion-treatment">
     Decay of effect of reperfusion treatment
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#aim">
   Aim
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#method">
   Method
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#steps">
     Steps
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#results">
   Results
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#notebook-admin">
   Notebook admin
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#define-probability-and-odds">
   Define probability and odds
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#probability">
     Probability
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#odds">
     Odds
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#collect-the-data">
   Collect the data
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-the-known-data">
     Plot the known data
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#steps-to-find-variation-with-time">
   Steps to find variation with time
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#find-a-straight-line-formula-for-log-odds">
     Find a straight line formula for log(odds)
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#find-an-exponential-formula-for-odds-with-time">
     Find an exponential formula for odds with time
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#find-a-logistic-formula-for-probability-with-time">
     Find a logistic formula for probability with time
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#application-to-our-data">
   Application to our data
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#calculate-a-and-b">
     Calculate
     <span class="math notranslate nohighlight">
      \(A\)
     </span>
     and
     <span class="math notranslate nohighlight">
      \(b\)
     </span>
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-the-new-time-distributions">
     Plot the new time distributions
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sidetrack-why-do-the-probability-lines-bend-differently">
   Sidetrack: Why do the probability lines bend differently?
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sidetrack-2-what-do-a-and-b-mean-for-probability">
   Sidetrack 2: What do
   <span class="math notranslate nohighlight">
    \(A\)
   </span>
   and
   <span class="math notranslate nohighlight">
    \(b\)
   </span>
   mean for probability?
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#references">
   References
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Mathematics for calculating odds and probabilities of mRS-level outcomes after stroke, based on time to reperfusion treatment</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Mathematics for calculating odds and probabilities of mRS-level outcomes after stroke, based on time to reperfusion treatment
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#modified-rankin-scale">
     Modified Rankin Scale
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#reperfusion-treatment-for-ischaemic-stroke">
     Reperfusion treatment for ischaemic stroke
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#decay-of-effect-of-reperfusion-treatment">
     Decay of effect of reperfusion treatment
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#aim">
   Aim
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#method">
   Method
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#steps">
     Steps
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#results">
   Results
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#notebook-admin">
   Notebook admin
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#define-probability-and-odds">
   Define probability and odds
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#probability">
     Probability
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#odds">
     Odds
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#collect-the-data">
   Collect the data
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-the-known-data">
     Plot the known data
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#steps-to-find-variation-with-time">
   Steps to find variation with time
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#find-a-straight-line-formula-for-log-odds">
     Find a straight line formula for log(odds)
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#find-an-exponential-formula-for-odds-with-time">
     Find an exponential formula for odds with time
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#find-a-logistic-formula-for-probability-with-time">
     Find a logistic formula for probability with time
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#application-to-our-data">
   Application to our data
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#calculate-a-and-b">
     Calculate
     <span class="math notranslate nohighlight">
      \(A\)
     </span>
     and
     <span class="math notranslate nohighlight">
      \(b\)
     </span>
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-the-new-time-distributions">
     Plot the new time distributions
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sidetrack-why-do-the-probability-lines-bend-differently">
   Sidetrack: Why do the probability lines bend differently?
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sidetrack-2-what-do-a-and-b-mean-for-probability">
   Sidetrack 2: What do
   <span class="math notranslate nohighlight">
    \(A\)
   </span>
   and
   <span class="math notranslate nohighlight">
    \(b\)
   </span>
   mean for probability?
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#references">
   References
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="mathematics-for-calculating-odds-and-probabilities-of-mrs-level-outcomes-after-stroke-based-on-time-to-reperfusion-treatment">
<h1>Mathematics for calculating odds and probabilities of mRS-level outcomes after stroke, based on time to reperfusion treatment<a class="headerlink" href="#mathematics-for-calculating-odds-and-probabilities-of-mrs-level-outcomes-after-stroke-based-on-time-to-reperfusion-treatment" title="Permalink to this headline">#</a></h1>
<p>In this notebook we explain how to derive various formulae for probability and odds that will be used in predicting modified Rankin Scale (mRS) after stroke, depending on time to treatment.</p>
<p>The data used in this example correspond to thrombectomy treatment, and can be switched for other data as required without changing the formulae.</p>
<section id="modified-rankin-scale">
<h2>Modified Rankin Scale<a class="headerlink" href="#modified-rankin-scale" title="Permalink to this headline">#</a></h2>
<p>The modified Rankin Scale (mRS) is a commonly used scale for measuring the degree of disability or dependence in the daily activities of people who have suffered a stroke or other causes of neurological disability [Saver <em>et al</em>., 2010].</p>
<p>The scale runs from 0-6, running from perfect health without symptoms to death:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Score</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>No symptoms.</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>No significant disability. Able to carry out all usual activities, despite some symptoms.</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>Slight disability. Able to look after own affairs without assistance, but unable to carry out all previous activities.</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>Moderate disability. Requires some help, but able to walk unassisted.</p></td>
</tr>
<tr class="row-even"><td><p>4</p></td>
<td><p>Moderately severe disability. Unable to attend to own bodily needs without assistance, and unable to walk unassisted.</p></td>
</tr>
<tr class="row-odd"><td><p>5</p></td>
<td><p>Severe disability. Requires constant nursing care and attention, bedridden, incontinent.</p></td>
</tr>
<tr class="row-even"><td><p>6</p></td>
<td><p>Dead.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="reperfusion-treatment-for-ischaemic-stroke">
<h2>Reperfusion treatment for ischaemic stroke<a class="headerlink" href="#reperfusion-treatment-for-ischaemic-stroke" title="Permalink to this headline">#</a></h2>
<p>Ischaemic stroke is a stroke caused by the blockage of blood supply to an area of the brain, caused by a clot. Ischaemic strokes account for 80-85% of all strokes, with the remainder being <em>haemorrhagic</em> strokes where loss of blood supply is caused by a bleed in the brain.</p>
<p><em>Reperfusion</em> describes the restoration of blood flow following an ischaemic stroke. There are two potential reperfusion treatments:</p>
<ul class="simple">
<li><p><em>Thrombolysis</em> (also known as as <em>intravenous thrombolysis</em>, IVT) is a medical therapy where <em>clot-busting</em> drugs are used to reduce or remove the blood clot. About 20% of all stroke patients are suitable for thrombolysis.</p></li>
<li><p><em>Thrombectomy</em> (also known as <em>mechanical thrombectomy</em>, MT) is the mechanical removal of a clot, by a mesh device under image guidance. Thrombectomy is suitable only for clots in a large vessel (these generally cause the worst strokes), and is a suitable treatment in about 10% of all stroke patients.</p></li>
</ul>
</section>
<section id="decay-of-effect-of-reperfusion-treatment">
<h2>Decay of effect of reperfusion treatment<a class="headerlink" href="#decay-of-effect-of-reperfusion-treatment" title="Permalink to this headline">#</a></h2>
<p>Reperfusion treatment becomes less effective with increasing time after stroke (with the loss of effect occurring over some hours). Emberson <em>et al.</em> and Fransen <em>et al.</em> have described the declining effect as the declining <em>odds ratio</em> of achieving an essentially <em>‘good outcome’</em> following thrombolysis (Emberson) or thrombectomy (Fransen). A <em>‘good outcome’</em> has been described differently with studied on thrombolysis generally using a threshold of mRS 0-1 at 3-6 months, and thrombectomy studies generally using a threshold of mRS 0-2 at 3-6 months. The <em>odds ratio</em> describes the odds of a <em>‘good outcome’</em> relative to the odds of a <em>‘good outcome’</em> in an untreated control group.</p>
<p>The deacy in effectiveness of reperfusion is shown in the figure below (left panel = odds ratio, right panel = log odds ratio, IVT = thrombolysis, MT = thrombectomy).</p>
<p><img alt="" src="_images/odds_decay.png" /></p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="aim">
<h1>Aim<a class="headerlink" href="#aim" title="Permalink to this headline">#</a></h1>
<p>We define outcome in terms of probability distributions of mRS scores.
We know all about the probabilities of mRS at <span class="math notranslate nohighlight">\(t=0\,\)</span>hr and <span class="math notranslate nohighlight">\(t=t_{\mathrm{ne}}\)</span>, the time of no effect, from <a class="reference external" href="https://github.com/samuel-book/stroke_outcome/blob/main/mRS_datasets_full.ipynb">our notebook on deriving the probability distributions</a>.
We need to use the data we have at these two fixed times to create models that describe probability at all <span class="math notranslate nohighlight">\(t\)</span>.</p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="method">
<h1>Method<a class="headerlink" href="#method" title="Permalink to this headline">#</a></h1>
<p>Since we know that probability, odds, and log(odds) are all linked,
we only need to find a formula for one of these distributions.
That formula can then be converted into the forms required to find the other quantities.
We’ll start with the simplest formula, which is for log(odds).</p>
<p>In the literature, the log(odds ratio) has been presented at regular time intervals and falls off approximately linearly with time <span class="math notranslate nohighlight">\(t\)</span>. This allows it to be modelled as a straight line.
The log(odds ratio) is used so that it is clear at what time the log(odds ratio) falls below zero, and so when to define the time of no effect.
Since we are using data where we already know this time of no effect and the probability distributions at that time, we can skip a step and directly model log(odds) as a straight line.
We can make this simplification because the straight line fits to log(odds) and to log(odds ratio) share a gradient and only differ in their start and end values (their displacement in <span class="math notranslate nohighlight">\(y\)</span>).
The straight line has a formula <span class="math notranslate nohighlight">\(\log(O) = A + bt\)</span> for constants <span class="math notranslate nohighlight">\(A\)</span> and <span class="math notranslate nohighlight">\(b\)</span>.</p>
<section id="steps">
<h2>Steps<a class="headerlink" href="#steps" title="Permalink to this headline">#</a></h2>
<p>The steps here are, for mRS<span class="math notranslate nohighlight">\(\leq\)</span>5<span class="math notranslate nohighlight">\(^*\)</span>:</p>
<ol class="simple">
<li><p>Define log(odds), a straight-line formula <span class="math notranslate nohighlight">\(A + bt\)</span>.</p></li>
<li><p>Find <span class="math notranslate nohighlight">\(A\)</span> and <span class="math notranslate nohighlight">\(b\)</span> using the known probabilities at <span class="math notranslate nohighlight">\(t=0\,\)</span>hr and <span class="math notranslate nohighlight">\(t=t_{\mathrm{ne}}\)</span>.</p></li>
<li><p>Define odds, an exponential decay, by converting log(odds).</p></li>
<li><p>Define probability as a function of <span class="math notranslate nohighlight">\(t\)</span> by converting odds.</p></li>
</ol>
<p><span class="math notranslate nohighlight">\(^*\)</span> We cannot include mRS<span class="math notranslate nohighlight">\(\leq\)</span>6 in these calculations, but luckily we already know that <span class="math notranslate nohighlight">\(P(\mathrm{mRS}\leq6)=1.0\)</span> at all <span class="math notranslate nohighlight">\(t\)</span>.</p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="results">
<h1>Results<a class="headerlink" href="#results" title="Permalink to this headline">#</a></h1>
<blockquote>
<div><p>Spoilers!</p>
</div></blockquote>
<p>The maths in this notebook will end up producing the following relations between time to treatment and the probability of each mRS bin.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">outcome_utilities.plot_probs_with_time</span>
</pre></div>
</div>
</div>
</div>
</section>
<hr class="docutils" />
<section class="tex2jax_ignore mathjax_ignore" id="notebook-admin">
<h1>Notebook admin<a class="headerlink" href="#notebook-admin" title="Permalink to this headline">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Keep notebook cleaner once finalised</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import packages</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set up MatPlotLib</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="c1"># Change default colour scheme:</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;seaborn-colorblind&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<hr class="docutils" />
<section class="tex2jax_ignore mathjax_ignore" id="define-probability-and-odds">
<h1>Define probability and odds<a class="headerlink" href="#define-probability-and-odds" title="Permalink to this headline">#</a></h1>
<p>All of the quantities we will define are only valid in the time range covered by our data, which is <span class="math notranslate nohighlight">\(0\leq t \leq t_{\mathrm{ne}}\)</span> for the no-effect time <span class="math notranslate nohighlight">\(t_{\mathrm{ne}}\)</span>.</p>
<section id="probability">
<h2>Probability<a class="headerlink" href="#probability" title="Permalink to this headline">#</a></h2>
<p>Firstly we will define some probability distributions in terms of <span class="math notranslate nohighlight">\(x\)</span>, which is a given modified Rankin Scale (mRS), and <span class="math notranslate nohighlight">\(t\)</span>, the time from onset to treatment.</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(P(\mathrm{mRS}=x\ |\ t)\)</span>, the probability distribution of mRS.</p></li>
<li><p><span class="math notranslate nohighlight">\(P(\mathrm{mRS}\leq x\ |\ t)\)</span>, the cumulative probability.</p></li>
</ul>
<p>In all cases, we know that:</p>
<ul class="simple">
<li><p>The probabilities of a condition being met and it not being met sum to 1: <span class="math notranslate nohighlight">\( P(\mathrm{mRS}&gt;x\ |\ t) = 1 - P(\mathrm{mRS}\leq x\ |\ t) \)</span></p></li>
<li><p>The probability of mRS<span class="math notranslate nohighlight">\(\leq6\)</span> is always equal to 1: <span class="math notranslate nohighlight">\(P(\mathrm{mRS}\leq6\ |\ t)=1\)</span> at all <span class="math notranslate nohighlight">\(t\)</span>.</p></li>
</ul>
</section>
<section id="odds">
<h2>Odds<a class="headerlink" href="#odds" title="Permalink to this headline">#</a></h2>
<p>The odds are an alternative way of expressing the likeliness of an event occurring. Odds are expressed in terms of how much more (or less) likely it is that a given outcome will be attained rather than any other outcomes.</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\mathrm{odds} =  \frac{\mathrm{probability\ of\ this\ outcome}}{\mathrm{probability\ of\ other\ outcomes}} \phantom{g} \mathrm{(single\ patient)}  \phantom{gap} =  \frac{\mathrm{number\ of\ this\ outcome}}{\mathrm{number\ of\ other\ outcomes}} \phantom{g} \mathrm{(group\ of\ patients)}\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(O(\mathrm{mRS}\leq x\ |\ t) = \frac{P(\mathrm{mRS}\leq x\ |\ t)}{P(\mathrm{mRS}&gt;x\ |\ t)}\)</span></p></li>
</ul>
<p>Special cases:</p>
<ul class="simple">
<li><p>When only half of the outcomes are good, i.e. probability=0.5, then odds=1 and log(odds)=0.</p></li>
<li><p>Odds and log(odds) for <span class="math notranslate nohighlight">\(\mathrm{mRS}\leq6\)</span> are not defined for any <span class="math notranslate nohighlight">\(t\)</span>. This is because <span class="math notranslate nohighlight">\(P(\mathrm{mRS}\leq6)=1.0\)</span> at all times, and so:
$<span class="math notranslate nohighlight">\(O(\mathrm{mRS}\leq6) = \frac{P(\mathrm{mRS}\leq6)}{1-P(\mathrm{mRS}\leq6)} = \frac{1}{0}\)</span>$</p></li>
</ul>
<p>Here we will calculate odds directly from probabilities, and so the odds will be given as non-integer positive numbers rather than fractions.</p>
<p>We will also consider the natural log of odds, i.e. <span class="math notranslate nohighlight">\(\log_{e}(\mathrm{odds})\)</span>. <strong>Whenever this notebook says “log”, it means natural log (base <span class="math notranslate nohighlight">\(e\)</span>).</strong></p>
</section>
</section>
<hr class="docutils" />
<section class="tex2jax_ignore mathjax_ignore" id="collect-the-data">
<h1>Collect the data<a class="headerlink" href="#collect-the-data" title="Permalink to this headline">#</a></h1>
<p>We’ll use the data for large-vessel occlusions (LVOs) that are treated with mechanical thrombectomy (MT), using the same probability distributions that we’ve defined in <a class="reference external" href="https://github.com/samuel-book/stroke_outcome/blob/main/mRS_datasets_full.ipynb">this notebook</a>.</p>
<p>Define the time of no effect <span class="math notranslate nohighlight">\(t_{\mathrm{ne}}\)</span> for LVOs treated with MT:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t_ne</span> <span class="o">=</span> <span class="mf">8.0</span> <span class="c1"># hours</span>
</pre></div>
</div>
</div>
</div>
<p>Distribution of probabilities in each bin, <span class="math notranslate nohighlight">\(P(\mathrm{mRS}=x)\)</span>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t0_st</span> <span class="o">=</span> <span class="s1">&#39;t0_treatment_lvo_mt&#39;</span>
<span class="n">ne_st</span> <span class="o">=</span> <span class="s1">&#39;no_effect_lvo_mt_deaths&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mRS_prob_all</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="s1">&#39;./outcome_utilities/mrs_dist_probs_bins.csv&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="s1">&#39;Stroke type&#39;</span><span class="p">)</span>

<span class="n">mRS_prob_t0_treatment</span> <span class="o">=</span> <span class="n">mRS_prob_all</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">t0_st</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">mRS_prob_no_effect</span> <span class="o">=</span> <span class="n">mRS_prob_all</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ne_st</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</pre></div>
</div>
</div>
</div>
<p>Cumulative probabilities (<code class="docutils literal notranslate"><span class="pre">cumsum</span></code>=’cum(ulative) sum’), <span class="math notranslate nohighlight">\(P(\mathrm{mRS}\leq x)\)</span>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mRS_prob_cumsum_all</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="s1">&#39;./outcome_utilities/mrs_dist_probs_cumsum.csv&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="s1">&#39;Stroke type&#39;</span><span class="p">)</span>

<span class="n">mRS_prob_cumsum_t0_treatment</span> <span class="o">=</span> <span class="n">mRS_prob_cumsum_all</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">t0_st</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">mRS_prob_cumsum_no_effect</span> <span class="o">=</span> <span class="n">mRS_prob_cumsum_all</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ne_st</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</pre></div>
</div>
</div>
</div>
<p>Convert probability to odds:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mRS_odds_cumsum_t0_treatment</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">mRS_prob_cumsum_t0_treatment</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">mRS_prob_cumsum_t0_treatment</span><span class="p">))</span>
<span class="n">mRS_odds_cumsum_no_effect</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">mRS_prob_cumsum_no_effect</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">mRS_prob_cumsum_no_effect</span><span class="p">))</span>

<span class="c1"># Manually set mRS&lt;=6 values to infinity, since P(mRS&lt;=6)=1:</span>
<span class="n">mRS_odds_cumsum_t0_treatment</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span> 
<span class="n">mRS_odds_cumsum_no_effect</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
</pre></div>
</div>
</div>
</div>
<p>Convert odds to log(odds):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mRS_logodds_cumsum_t0_treatment</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">mRS_odds_cumsum_t0_treatment</span><span class="p">)</span>
<span class="n">mRS_logodds_cumsum_no_effect</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">mRS_odds_cumsum_no_effect</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="plot-the-known-data">
<h2>Plot the known data<a class="headerlink" href="#plot-the-known-data" title="Permalink to this headline">#</a></h2>
<p>The following two cells define some colours and a plotting function that we’ll use here and later in the notebook:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">colour_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;#0072B2&#39;</span><span class="p">,</span> <span class="s1">&#39;#009E73&#39;</span><span class="p">,</span> <span class="s1">&#39;#D55E00&#39;</span><span class="p">,</span> <span class="s1">&#39;#CC79A7&#39;</span><span class="p">,</span> <span class="s1">&#39;#F0E442&#39;</span><span class="p">,</span> 
                        <span class="s1">&#39;#56B4E9&#39;</span><span class="p">,</span> <span class="s1">&#39;DarkSlateGray&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;&lt;U13&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_three_with_time</span><span class="p">(</span><span class="n">ylabels</span><span class="p">,</span> <span class="n">data_lists</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">gridspec_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;wspace&#39;</span><span class="p">:</span><span class="mf">0.3</span><span class="p">})</span>
    <span class="k">for</span> <span class="n">d</span><span class="p">,</span><span class="n">data_list</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data_lists</span><span class="p">):</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="n">d</span><span class="p">]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
        <span class="n">d_t0</span> <span class="o">=</span> <span class="n">data_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">d_no</span> <span class="o">=</span> <span class="n">data_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span><span class="n">t_ne</span><span class="p">],</span> <span class="p">[</span><span class="n">d_t0</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">d_no</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span>
                       <span class="n">color</span><span class="o">=</span><span class="n">colour_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> 
                       <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;$\leq$</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabels</span><span class="p">[</span><span class="n">d</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">ylabels</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">t_ne</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Onset to treatment time (hours)&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">d</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper center&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.15</span><span class="p">],</span> 
                      <span class="n">ncol</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;mRS&#39;</span><span class="p">)</span>

    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">11.5</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span>
</pre></div>
</div>
</div>
</div>
<p>This cell produces the plot of probability, odds, and log(odds):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_lists</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="n">mRS_prob_cumsum_t0_treatment</span><span class="p">,</span> <span class="n">mRS_prob_cumsum_no_effect</span><span class="p">],</span>
    <span class="p">[</span><span class="n">mRS_odds_cumsum_t0_treatment</span><span class="p">,</span> <span class="n">mRS_odds_cumsum_no_effect</span><span class="p">],</span>
    <span class="p">[</span><span class="n">mRS_logodds_cumsum_t0_treatment</span><span class="p">,</span> <span class="n">mRS_logodds_cumsum_no_effect</span><span class="p">]</span>
    <span class="p">]</span>

<span class="n">ylabels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Probability&#39;</span><span class="p">,</span> <span class="s1">&#39;Odds&#39;</span><span class="p">,</span> <span class="s1">&#39;log(Odds)&#39;</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plot_three_with_time</span><span class="p">(</span><span class="n">ylabels</span><span class="p">,</span> <span class="n">data_lists</span><span class="p">)</span>

<span class="c1"># plt.savefig(&#39;./images/time_varying_probs_odds_logodds_data-only.jpg&#39;, </span>
<span class="c1">#             dpi=300, bbox_inches=&#39;tight&#39;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/mRS_outcomes_maths_29_0.png" src="_images/mRS_outcomes_maths_29_0.png" />
</div>
</div>
<p>Now, for each graph we need to connect the two sets of data at <span class="math notranslate nohighlight">\(t=0\)</span> and the no-effect time by finding out how probability, odds and log(odds) vary with time.</p>
</section>
</section>
<hr class="docutils" />
<section class="tex2jax_ignore mathjax_ignore" id="steps-to-find-variation-with-time">
<h1>Steps to find variation with time<a class="headerlink" href="#steps-to-find-variation-with-time" title="Permalink to this headline">#</a></h1>
<section id="find-a-straight-line-formula-for-log-odds">
<h2>Find a straight line formula for log(odds)<a class="headerlink" href="#find-a-straight-line-formula-for-log-odds" title="Permalink to this headline">#</a></h2>
<p>We start with two different ways to write log(odds):</p>
<ul class="simple">
<li><p>Firstly, in terms of probability we have defined $<span class="math notranslate nohighlight">\( \log\bigl[O(\mathrm{mRS}\leq x\ |\ t)\bigr] = \log\left[ \frac{P(\mathrm{mRS}\leq x\ |\ t)}{1-P(\mathrm{mRS}\leq x\ |\ t)} \right] \)</span>$</p></li>
<li><p>Secondly, we assume that there is a linear relationship between log(odds) and time for all values of mRS. This gives $<span class="math notranslate nohighlight">\( \log\bigl[O(\mathrm{mRS}\leq x\ |\ t)\bigr] = A_x + b_xt \)</span><span class="math notranslate nohighlight">\( where the values of the constants \)</span>A<span class="math notranslate nohighlight">\( and \)</span>b<span class="math notranslate nohighlight">\( are different for each \)</span>x<span class="math notranslate nohighlight">\(. **\)</span>A<span class="math notranslate nohighlight">\( is log(odds) at t=0**, and **\)</span>b<span class="math notranslate nohighlight">\( is the gradient of the straight line**. We expect \)</span>b_x<span class="math notranslate nohighlight">\( to always be negative because the log(odds) is always greater at \)</span>t=0$ than at the no-effect time.</p></li>
</ul>
<p>Equating these gives the following relation that holds for all <span class="math notranslate nohighlight">\(t\)</span>:</p>
<div class="math notranslate nohighlight">
\[ A_x + b_xt = \log\left[ \frac{P(\mathrm{mRS}\leq x\ |\ t)}{1-P(\mathrm{mRS}\leq x\ |\ t)} \right] \]</div>
<p>To find <span class="math notranslate nohighlight">\(A\)</span> and <span class="math notranslate nohighlight">\(b\)</span>, we need to consider the values of log(odds) when <span class="math notranslate nohighlight">\(t=0\,\)</span>hr or <span class="math notranslate nohighlight">\(t=t_{\mathrm{ne}}\)</span>, as this is the data available to us.</p>
<p>When <span class="math notranslate nohighlight">\(t=0\)</span>,</p>
<div class="math notranslate nohighlight">
\[ A_x = \log\left[ \frac{P(\mathrm{mRS}\leq x\ |\ t=0)}{1-P(\mathrm{mRS}\leq x\ |\ t=0)} \right] \]</div>
<p>When <span class="math notranslate nohighlight">\(t=t_{\mathrm{ne}}\)</span>,</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align*}
A_x + b_xt_{\mathrm{ne}} &amp;= \log\left[ \frac{P(\mathrm{mRS}\leq x\ |\ t_\mathrm{ne})}{1-P(\mathrm{mRS}\leq x\ |\ t_\mathrm{ne})} \right] \\
b_x &amp;= \frac{1}{t_{\mathrm{ne}}} \left( \log\left[ \frac{P(\mathrm{mRS}\leq x\ |\ t_\mathrm{ne})}{1-P(\mathrm{mRS}\leq x\ |\ t_\mathrm{ne})} \right] - A_x\right) 
\end{align*}
\end{split}\]</div>
<p>In both cases, we know all of the <span class="math notranslate nohighlight">\(P\)</span> and <span class="math notranslate nohighlight">\(t\)</span> terms on the right-hand-side and so we can calculate <span class="math notranslate nohighlight">\(A\)</span> and <span class="math notranslate nohighlight">\(b\)</span>.</p>
</section>
<section id="find-an-exponential-formula-for-odds-with-time">
<h2>Find an exponential formula for odds with time<a class="headerlink" href="#find-an-exponential-formula-for-odds-with-time" title="Permalink to this headline">#</a></h2>
<p>We can take the exponential of <span class="math notranslate nohighlight">\( \log\bigl[O(\mathrm{mRS}\leq x\ |\ t)\bigr] = A_x + b_xt \)</span> to find an equation for odds:</p>
<div class="math notranslate nohighlight">
\[ O(\mathrm{mRS}\leq x\ |\ t) = e^{Ax + bx\cdot t} \]</div>
<p>To see how this behaves, we can split the two terms in the exponential:</p>
<div class="math notranslate nohighlight">
\[ O(\mathrm{mRS}\leq x\ |\ t) = e^{Ax} \cdot e^{bx\cdot t} \]</div>
<p>and use <span class="math notranslate nohighlight">\(A_x = \log\bigl[O(\mathrm{mRS}\leq x\ |\ t=0)\bigr]\)</span>, so</p>
<div class="math notranslate nohighlight">
\[ O(\mathrm{mRS}\leq x\ |\ t) = O(\mathrm{mRS}\leq x\ |\ t=0) \cdot e^{bx\cdot t} \]</div>
<p>This tells us that odds will decay exponentially with time because <span class="math notranslate nohighlight">\(b_x\)</span> is always negative.</p>
</section>
<section id="find-a-logistic-formula-for-probability-with-time">
<h2>Find a logistic formula for probability with time<a class="headerlink" href="#find-a-logistic-formula-for-probability-with-time" title="Permalink to this headline">#</a></h2>
<p>Now we can set the expression for the odds ratio in exponential form equal to its definition in terms of probability:</p>
<div class="math notranslate nohighlight">
\[O(\mathrm{mRS}\leq x\ |\ t) \phantom{g} = \phantom{g} e^{Ax + bx\cdot t} \phantom{g} = \phantom{g} \frac{P(\mathrm{mRS}\leq x\ |\ t)}{1 - P(\mathrm{mRS}\leq x\ |\ t)} \]</div>
<p>By setting <span class="math notranslate nohighlight">\(P \equiv P(\mathrm{mRS}\leq x\ |\ t)\)</span> and odds <span class="math notranslate nohighlight">\(O \equiv e^{Ax + bx \cdot t}\)</span>, we can invert this to find a formula for <span class="math notranslate nohighlight">\(P\)</span>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align*} 
O &amp; = \frac{P}{1 - P} \\
O(1-P) &amp; = P \\
O - (O\cdot P) &amp; = P \\ 
O &amp; = P + (O\cdot P) \\
O &amp; = P(1+O) \\
\frac{O}{1+O} &amp; = P \\
\end{align*}
\end{split}\]</div>
<p>To simplify this, we can multiply the left-hand-side by a factor of <span class="math notranslate nohighlight">\(\frac{1}{O}\div\frac{1}{O}\)</span>, which is equal to 1:</p>
<div class="math notranslate nohighlight">
\[ P \phantom{g} = \phantom{g} \frac{O}{1+O} \cdot  \frac{\frac{1}{O}}{\frac{1}{O}} \phantom{g} = \phantom{g}  \frac{1}{\frac{1}{O} + 1}\]</div>
<p>Then <span class="math notranslate nohighlight">\(\frac{1}{O} = O^{-1} = \bigl(e^{Ax+bx\cdot t}\bigr)^{-1} = e^{-(Ax+bx\cdot t)}\)</span>, so</p>
<div class="math notranslate nohighlight">
\[ P(\mathrm{mRS}\leq x\ |\ t) = \frac{1}{1+e^{-(Ax + bx\cdot t)}} \]</div>
<p>Finally, we have a formula to calculate <span class="math notranslate nohighlight">\(P\)</span> at any time <span class="math notranslate nohighlight">\(t\)</span>.</p>
<blockquote>
<div><p><strong>An optional extra step:</strong></p>
<p>This equation for <span class="math notranslate nohighlight">\(P(\mathrm{mRS}\leq x\ |\ t)\)</span> is almost in the form of a <a class="reference external" href="https://en.wikipedia.org/wiki/Logistic_function">logistic function</a>:</p>
<div class="math notranslate nohighlight">
\[ f(x) = \frac{L}{1 + e^{-k(x - x_0)}} \]</div>
<p>With one more rearrangement <span class="math notranslate nohighlight">\( A_x + b_x t = b_x\left(t +\frac{Ax}{bx}\right) \)</span>, we have:</p>
<div class="math notranslate nohighlight">
\[ P(\mathrm{mRS}\leq x\ |\ t) = \frac{1}{1+\exp{\bigl[-b_x\left(t +\frac{Ax}{bx}\right)\bigr]}} \]</div>
<p>Compared with <span class="math notranslate nohighlight">\(f(x)\)</span> above, <span class="math notranslate nohighlight">\(L=1\)</span>, <span class="math notranslate nohighlight">\(k=b_x\)</span>, <span class="math notranslate nohighlight">\(x=t\)</span>, and <span class="math notranslate nohighlight">\(x_0 = -\frac{Ax}{bx}\)</span>.</p>
</div></blockquote>
</section>
</section>
<hr class="docutils" />
<section class="tex2jax_ignore mathjax_ignore" id="application-to-our-data">
<h1>Application to our data<a class="headerlink" href="#application-to-our-data" title="Permalink to this headline">#</a></h1>
<section id="calculate-a-and-b">
<h2>Calculate <span class="math notranslate nohighlight">\(A\)</span> and <span class="math notranslate nohighlight">\(b\)</span><a class="headerlink" href="#calculate-a-and-b" title="Permalink to this headline">#</a></h2>
<p>We’ve found formulae to show how probability, odds and log(odds) vary with time. All three of these formulae require the same values of <span class="math notranslate nohighlight">\(A_x\)</span> and <span class="math notranslate nohighlight">\(b_x\)</span>, which we can calculate using the known probabilities at time zero and the no-effect time:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use the [:-1] slice to exclude mRS&lt;=6.</span>
<span class="n">A</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">mRS_prob_cumsum_t0_treatment</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> 
     <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">mRS_prob_cumsum_t0_treatment</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span> 
<span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">mRS_prob_cumsum_no_effect</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> 
     <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">mRS_prob_cumsum_no_effect</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span><span class="n">A</span><span class="p">)</span><span class="o">/</span><span class="n">t_ne</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">A</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code> are arrays that each contain 6 values, one each for mRS<span class="math notranslate nohighlight">\(\leq\)</span>0,1,2,3,4,5. The following cell prints out these values as a table:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;| mRS | log(odds) at t=0 |    `A`   |    `b`   |&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">48</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;|  </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">  |&#39;</span><span class="o">+</span>
          <span class="sa">f</span><span class="s1">&#39;      </span><span class="si">{</span><span class="n">mRS_logodds_cumsum_t0_treatment</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s1">7.4f</span><span class="si">}</span><span class="s1">     |&#39;</span><span class="o">+</span>
          <span class="sa">f</span><span class="s1">&#39;  </span><span class="si">{</span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s1">7.4f</span><span class="si">}</span><span class="s1"> |&#39;</span><span class="o">+</span>
          <span class="sa">f</span><span class="s1">&#39;  </span><span class="si">{</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s1">7.4f</span><span class="si">}</span><span class="s1"> |&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>| mRS | log(odds) at t=0 |    `A`   |    `b`   |
------------------------------------------------
|  0  |      -0.7811     |  -0.7811 |  -0.2764 |
|  1  |      -0.2561     |  -0.2561 |  -0.2132 |
|  2  |       0.2186     |   0.2186 |  -0.1625 |
|  3  |       0.9068     |   0.9068 |  -0.1589 |
|  4  |       1.7631     |   1.7631 |  -0.1452 |
|  5  |       2.3990     |   2.3990 |  -0.1453 |
</pre></div>
</div>
</div>
</div>
<p>As expected, <span class="math notranslate nohighlight">\(A\)</span> is equal to the log-odds at <span class="math notranslate nohighlight">\(t=0\,\)</span>hr and all of the <span class="math notranslate nohighlight">\(b\)</span> values are negative because log(odds) decreases with time.</p>
</section>
<section id="plot-the-new-time-distributions">
<h2>Plot the new time distributions<a class="headerlink" href="#plot-the-new-time-distributions" title="Permalink to this headline">#</a></h2>
<p>The following cell draws the same graphs as before, and now adds the variations with time.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ylabels</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;Probability</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;$P$(mRS$\leq$ x | t) = &#39;</span><span class="o">+</span>
    <span class="sa">r</span><span class="s1">&#39;$\frac</span><span class="si">{1}</span><span class="s1">{1 + e^{-(Ax + bx\cdot t)}}$&#39;</span><span class="p">),</span> 
    <span class="s1">&#39;Odds</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;$O$(mRS$\leq$ x | t) = $e^{(A_x + b_x\cdot t)}$&#39;</span><span class="p">,</span> 
    <span class="s1">&#39;log(Odds)</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;$\log$[$O$(mRS$\leq$ x | t)] = $A_x + b_x\cdot t$&#39;</span>
    <span class="p">]</span>

<span class="c1"># Plot over this time range:</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">t_ne</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)</span>

<span class="c1"># Make the same plot as earlier...</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plot_three_with_time</span><span class="p">(</span><span class="n">ylabels</span><span class="p">,</span> <span class="n">data_lists</span><span class="p">)</span>

<span class="c1"># ... and now add lines to connect the starting data points: </span>
<span class="k">for</span> <span class="n">d</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axs</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">d</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="c1"># Probability:</span>
            <span class="n">yvals</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">t</span><span class="o">+</span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="p">)</span>
        <span class="k">elif</span> <span class="n">d</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span> <span class="c1"># Odds:</span>
            <span class="n">yvals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="c1"># log(odds):</span>
            <span class="n">yvals</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">t</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">yvals</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colour_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            
<span class="c1"># plt.savefig(&#39;./images/time_varying_probs_odds_logodds.jpg&#39;, </span>
<span class="c1">#             dpi=300, bbox_inches=&#39;tight&#39;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/mRS_outcomes_maths_43_0.png" src="_images/mRS_outcomes_maths_43_0.png" />
</div>
</div>
<p><strong>Success!</strong> We started with the data at t=0 and t=<span class="math notranslate nohighlight">\(t_{\mathrm{ne}}\)</span> (8 hours) and have calculated the lines in between.</p>
</section>
</section>
<hr class="docutils" />
<section class="tex2jax_ignore mathjax_ignore" id="sidetrack-why-do-the-probability-lines-bend-differently">
<h1>Sidetrack: Why do the probability lines bend differently?<a class="headerlink" href="#sidetrack-why-do-the-probability-lines-bend-differently" title="Permalink to this headline">#</a></h1>
<blockquote>
<div><p>This section isn’t essential to understanding the probability calculation or the outcome model.</p>
</div></blockquote>
<p>In the graph of probability with time, the lines for each mRS follow a different path. The gradient of the bottom mRS<span class="math notranslate nohighlight">\(\leq\)</span>0 line becomes less negative with increasing time, as though gradually curving upwards, whereas the top mRS<span class="math notranslate nohighlight">\(\leq\)</span>4 line has a gradient becoming more negative with time, as though curving downwards.</p>
<p>The reason for this is best explained by showing a similar line, another logistic function, with a new parameter <span class="math notranslate nohighlight">\(v=-b(t+\frac{A}{b})\)</span>, so</p>
<div class="math notranslate nohighlight">
\[ P(v) = \frac{1}{1+e^{v}} \]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define some new parameter &quot;v&quot; for the x-axis:</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>

<span class="c1"># Add a couple of key lines:</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;Gainsboro&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;Gainsboro&#39;</span><span class="p">)</span>

<span class="c1"># Plot probability as a function of &quot;v&quot;:</span>
<span class="n">p_v</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mf">1.0</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">p_v</span><span class="p">)</span>

<span class="c1"># Draw the straight line connection:</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">v</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span> <span class="p">[</span><span class="n">p_v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">p_v</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span>
        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>

<span class="c1"># The usual setup:</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;P(v)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;v&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Probability&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/mRS_outcomes_maths_48_0.png" src="_images/mRS_outcomes_maths_48_0.png" />
</div>
</div>
<p>The bend of <span class="math notranslate nohighlight">\(P(v)\)</span> changes at <span class="math notranslate nohighlight">\(v=0\)</span>, where <span class="math notranslate nohighlight">\(P(v)=0.5\)</span>. The <span class="math notranslate nohighlight">\(P(\mathrm{mRS})\)</span> lines are different shapes because some of them show mostly the <span class="math notranslate nohighlight">\(v&gt;0\)</span> curve (i.e. mRS=0,1), and the rest the <span class="math notranslate nohighlight">\(v&lt;0\)</span> part (i.e. mRS<span class="math notranslate nohighlight">\(\geq\)</span>2). This can be viewed as the <span class="math notranslate nohighlight">\(v\)</span>-axis here being offset to the right in the <span class="math notranslate nohighlight">\(P(t)\)</span> plots above. The size of the offset is different for each mRS line.</p>
<p>The find the offset, we can convert from <span class="math notranslate nohighlight">\(v\)</span> to <span class="math notranslate nohighlight">\(t\)</span>. Because <span class="math notranslate nohighlight">\(v=-b(t+\frac{A}{b}) =-(A+bt)\)</span>, then <span class="math notranslate nohighlight">\(t=-\frac{1}{b}(v+A)\)</span>. On the <span class="math notranslate nohighlight">\(t\)</span>-axis, the key point corresponding to <span class="math notranslate nohighlight">\(v=0\)</span> is <span class="math notranslate nohighlight">\(t_k=-\frac{A}{b}\)</span>. This <span class="math notranslate nohighlight">\(t_k\)</span> is different for each of the mRS lines, which is why each <span class="math notranslate nohighlight">\(P(t)\)</span> line shows a different shift sideways from <span class="math notranslate nohighlight">\(P(v)\)</span>.</p>
<p>We can plot the <span class="math notranslate nohighlight">\(P(t)\)</span> lines again and add the key points where the bend changes:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">t_ne</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">t_long</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="n">t_ne</span><span class="o">+</span><span class="mi">12</span><span class="p">)</span>

<span class="c1"># Store the key times t_k in this list:</span>
<span class="n">tk_list</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Use a wider figure than usual:</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">A_i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">A</span><span class="p">):</span>    
    <span class="c1"># Plot probability:</span>
    <span class="n">p_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">A_i</span> <span class="o">+</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">A_i</span> <span class="o">+</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">t</span><span class="p">))</span>
    <span class="n">l</span><span class="p">,</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">p_i</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;mRS &lt;= </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">colour</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">get_color</span><span class="p">()</span>
    
    <span class="c1"># Plot probability over the longer time range:</span>
    <span class="n">p_long</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">A_i</span> <span class="o">+</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">t_long</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">A_i</span> <span class="o">+</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">t_long</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_long</span><span class="p">,</span> <span class="n">p_long</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colour</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
    
    <span class="c1"># Mark t=0 and t=t_ne data:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span>    <span class="n">mRS_prob_cumsum_t0_treatment</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colour</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">t_ne</span><span class="p">,</span> <span class="n">mRS_prob_cumsum_no_effect</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colour</span><span class="p">)</span>
    
    <span class="c1"># Calculate the key time and store it:</span>
    <span class="n">t_k</span> <span class="o">=</span> <span class="o">-</span><span class="n">A_i</span><span class="o">/</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">tk_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t_k</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">t_k</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">A_i</span> <span class="o">+</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">t_k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">A_i</span> <span class="o">+</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">t_k</span><span class="p">)),</span>
                <span class="n">facecolor</span><span class="o">=</span><span class="n">colour</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> 
                <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">70</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    
<span class="c1"># # Add vertical lines at valid time boundaries:</span>
<span class="c1"># for v_pos in [0.0, t_ne]:</span>
<span class="c1">#     plt.axvline(v_pos, lw=1, color=&#39;Gainsboro&#39;, zorder=0)</span>
    
<span class="c1"># Add a horizontal line at P=0.5:</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># The usual setup:</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Probability&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Onset to treatment time (hours)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Probability&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/mRS_outcomes_maths_50_0.png" src="_images/mRS_outcomes_maths_50_0.png" />
</div>
</div>
<p>Note that the scattered points above at <span class="math notranslate nohighlight">\(t=t_k\)</span> all share a probability <span class="math notranslate nohighlight">\(P(t=t_k)=0.5\)</span>.</p>
<p>Print the key times:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;mRS | Key time&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">  | </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">tk_list</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="si">:</span><span class="s1">2.0f</span><span class="si">}</span><span class="s1"> hours &#39;</span><span class="o">+</span>
          <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tk_list</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span><span class="o">%</span><span class="mi">1</span> <span class="o">*</span><span class="mf">60.0</span><span class="si">:</span><span class="s1">2.0f</span><span class="si">}</span><span class="s1"> mins&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>mRS | Key time
 0  | -2 hours 50 mins
 1  | -1 hours 12 mins
 2  |  1 hours 21 mins
 3  |  5 hours 42 mins
 4  | 12 hours  9 mins
 5  | 16 hours 31 mins
</pre></div>
</div>
</div>
</div>
</section>
<hr class="docutils" />
<section class="tex2jax_ignore mathjax_ignore" id="sidetrack-2-what-do-a-and-b-mean-for-probability">
<h1>Sidetrack 2: What do <span class="math notranslate nohighlight">\(A\)</span> and <span class="math notranslate nohighlight">\(b\)</span> mean for probability?<a class="headerlink" href="#sidetrack-2-what-do-a-and-b-mean-for-probability" title="Permalink to this headline">#</a></h1>
<blockquote>
<div><p>This section also isn’t essential to understanding the probability calculation or the outcome model.</p>
</div></blockquote>
<p>We have defined probability as a logistic function:</p>
<div class="math notranslate nohighlight">
\[ P = \frac{1}{1+e^{-b\left(t +\frac{A}{b}\right)}} \]</div>
<p>Changing <em>A</em> and <em>b</em> then changes the slope of the function and its offset left and right.</p>
<p>To see these changes, we’ll plot a logistic function with an arbitrary <em>A</em> and <em>b</em>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">A_start</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.91</span> 
<span class="n">b_start</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span>
</pre></div>
</div>
</div>
</div>
<p>And compare it with probability data <span class="math notranslate nohighlight">\(P(\mathrm{mRS}\leq \mathrm{mRS}_x)\)</span> for this value of mRS<span class="math notranslate nohighlight">\(_x\)</span> where we know the target values of <em>A</em> and <em>b</em>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mRS_x</span> <span class="o">=</span> <span class="mi">3</span>

<span class="n">A_target</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="n">mRS_x</span><span class="p">]</span>
<span class="n">b_target</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="n">mRS_x</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">A_target</span><span class="p">,</span> <span class="n">b_target</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>9.067535172708903e-01 -0.15886216301297962
</pre></div>
</div>
</div>
</div>
<p>We’ll also plot over this time range, which is longer than usual:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="n">t_ne</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span><span class="n">t_ne</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>To save repeating some code, we’ll put the plot setup into this function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_probs_logistic</span><span class="p">():</span>
    <span class="c1"># Mark the central point of the standard logistic function:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Plot the two known data points for this mRS:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span><span class="n">t_ne</span><span class="p">],</span> 
                <span class="p">[</span><span class="n">mRS_prob_cumsum_t0_treatment</span><span class="p">[</span><span class="n">mRS_x</span><span class="p">],</span>
                 <span class="n">mRS_prob_cumsum_no_effect</span><span class="p">[</span><span class="n">mRS_x</span><span class="p">]],</span> 
                <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Data&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="c1"># The usual setup:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;P(t)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;t (hours)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Probability&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>First, we’ll plot the effect of changing <em>A</em>. At time zero, <span class="math notranslate nohighlight">\( P(t=0) = \frac{1}{1+e^{-A}} \)</span> so <em>A</em> adjusts the x-offset of the curve. We can show this by plotting a series of curves where everything is identical except for <em>A</em>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_probs_logistic</span><span class="p">()</span>

<span class="c1"># Plot lines for this many values of A...</span>
<span class="n">n_lines</span> <span class="o">=</span> <span class="mi">5</span>
<span class="c1"># ... in these colours:</span>
<span class="n">colours</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;viridis&#39;</span><span class="p">)(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">n_lines</span><span class="p">))</span>

<span class="c1"># Plot probability as a function of time:</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">A_line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">A_start</span><span class="p">,</span> <span class="n">A_target</span><span class="p">,</span> <span class="n">n_lines</span><span class="p">)):</span>
    <span class="n">p_t</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mf">1.0</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">b_start</span> <span class="o">*</span> <span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="n">A_line</span><span class="o">/</span><span class="n">b_start</span><span class="p">))</span> <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">p_t</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colours</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;A = </span><span class="si">{</span><span class="n">A_line</span><span class="si">:</span><span class="s1">1.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.2</span><span class="p">])</span> <span class="c1"># outside axis</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/mRS_outcomes_maths_66_0.png" src="_images/mRS_outcomes_maths_66_0.png" />
</div>
</div>
<p>For the palest line, changing <em>A</em> has fixed the probability line in the right spot at time zero. However, the line is currently nowhere near the data point at the no-effect time. To fix this, we have to change the value of <em>b</em>.</p>
<p>Changing <em>b</em> effectively changes two things simultaneously. It changes the slope of the line, so that the logistic function looks more flattened out or stretched tall. But since <em>b</em> cannot change the value of the probability at time zero, changing <em>b</em> must also move the probability line left or right to account for the changes. This is seen in the following plot, where every parameter of each curve is identical except for <em>b</em>. The palest yellow line is the same as in the previous plot.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_probs_logistic</span><span class="p">()</span>

<span class="c1"># Plot lines for this many values of b...</span>
<span class="n">n_lines</span> <span class="o">=</span> <span class="mi">5</span>
<span class="c1"># ... in these colours:</span>
<span class="n">colours</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;viridis&#39;</span><span class="p">)(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">n_lines</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">b_line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">b_start</span><span class="p">,</span> <span class="n">b_target</span><span class="p">,</span> <span class="n">n_lines</span><span class="p">)):</span>
    <span class="c1"># Plot probability as a function of time:</span>
    <span class="n">p_t</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mf">1.0</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">b_line</span> <span class="o">*</span> <span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="n">A_target</span><span class="o">/</span><span class="n">b_line</span><span class="p">))</span> <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">p_t</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colours</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;b = </span><span class="si">{</span><span class="n">b_line</span><span class="si">:</span><span class="s1">1.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.2</span><span class="p">])</span> <span class="c1"># outside axis</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/mRS_outcomes_maths_68_0.png" src="_images/mRS_outcomes_maths_68_0.png" />
</div>
</div>
<p>Each line has a different slope because of the changed <em>b</em>, but also a different x-offset - the lines cross <span class="math notranslate nohighlight">\(P(t)=0.5\)</span> at different times. The darkest line uses the only combination of <em>A</em> and <em>b</em> that will pass through both data points simultaneously.</p>
<p>Since our calculated <span class="math notranslate nohighlight">\(P(\mathrm{mRS})\)</span> lines all use different values of <em>A</em> and <em>b</em>, we end up plotting each line with a different slope and x-offset.</p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="references">
<h1>References<a class="headerlink" href="#references" title="Permalink to this headline">#</a></h1>
<p>Emberson J, Lees KR, Lyden P, et al. Effect of treatment delay, age, and stroke severity on the effects of intravenous thrombolysis with alteplase for acute ischaemic stroke: A meta-analysis of individual patient data from randomised trials. The Lancet 2014;384:1929–35. doi:10.1016/S0140-6736(14)60584-5</p>
<p>Fransen PSS, Berkhemer OA, Lingsma HF, et al. Time to Reperfusion and Treatment Effect for Acute Ischemic Stroke: A Randomized Clinical Trial. JAMA Neurol 2016;73:190–6. doi:10.1001/jamaneurol.2015.3886</p>
<p>Saver JL, Filip B, Hamilton S, et al. Improving the Reliability of Stroke Disability Grading in Clinical Trials and Clinical Practice. Stroke 2010;41:992–5. doi:10.1161/STROKEAHA.109.571364</p>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="mRS_datasets_full.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Defining modified Rankin Scale (mRS) probability distributions for untreated patients, and predicted distributions if treatment given at time of stroke onset</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="demo_of_outcome_model.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Example output from stroke outcome model</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Anna Laws, Kerry Pearn & Michael Allen<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>