

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Excess death rate calculations &#8212; Stroke outcome modelling</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=c5ced968eda925caa686" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=c5ced968eda925caa686" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=c5ced968eda925caa686" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=c5ced968eda925caa686" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=c5ced968eda925caa686" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=c5ced968eda925caa686" />
  <script src="../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=c5ced968eda925caa686"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'outcome_model_methods/01b_excess_deaths';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Extrapolating a known odds ratio back to time zero" href="01c_extrapolate_time_zero.html" />
    <link rel="prev" title="Derivation of mRS distributions from reference data" href="01_mrs_dist_derivation.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
  
    <p class="title logo__title">Stroke outcome modelling</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Introduction
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">üìö Definitions reference</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../definitions_reference/definitions_stroke.html">Definitions for stroke</a></li>
<li class="toctree-l1"><a class="reference internal" href="../definitions_reference/definitions_maths.html">Definitions for maths</a></li>
<li class="toctree-l1"><a class="reference internal" href="../definitions_reference/paper.html">Paper creation</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">üßÆ Outcome model methods</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="01_mrs_dist_derivation.html">Derivation of mRS distributions from reference data</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Excess death rate calculations</a></li>
<li class="toctree-l2"><a class="reference internal" href="01c_extrapolate_time_zero.html">Extrapolating a known odds ratio back to time zero</a></li>

<li class="toctree-l2"><a class="reference internal" href="01d_lvo_proportion.html">Proportion of ischaemic patients with LVO</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="02_probs_with_time.html">Calculating outcome probabilities with time to treatment</a></li>



<li class="toctree-l1 has-children"><a class="reference internal" href="intro_extra.html">Extra details</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="02b_formulae.html">Extra: Formulae for probabilities with time</a></li>



<li class="toctree-l2"><a class="reference internal" href="02c_extra_maths.html">Extra: Logistic functions</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">üì¶ stroke-outcome package</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../package_docs/intro.html">Stroke outcome</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../package_docs/docs_continuous_outcome.html">Documentation: Continuous outcome model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../package_docs/demo_continuous_outcomes.html">Demo: Continuous outcome model</a></li>

<li class="toctree-l2"><a class="reference internal" href="../package_docs/docs_discrete_outcome.html">Documentation: Discrete outcome model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../package_docs/demo_discrete_outcomes.html">Demo: discrete outcome model</a></li>

</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">üìà General results</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../general_results/01b_population.html">Example patient population and pathway timings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../general_results/04_matrix.html">Demonstration of added utility depending on time to IVT and MT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../general_results/04b_matrix_maths.html">Quantifying added utility depending on time to IVT and MT</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">üß≠ Generic geography</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../general_results/05_geography.html">Distance-based treatment effects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../general_results/05_geography_outcomes.html">Calculate distance-based treatment effects for many cohorts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../general_results/05c_geography_outcomes_plots.html">Plot distance-based treatment effects for many cohorts</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">üåç Application to England and Wales</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../england_wales/intro_data.html">Data creation</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../admission_prediction/01_msoa_regression.html">Emergency stroke admissions predictions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../england_wales/01_model_outcomes.html">Calculate outcomes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../england_wales/01c_weighted_outcomes.html">Combine populations for weighted outcomes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../england_wales/01d_weighted_outcomes_mrs_dists.html">Combine populations for weighted mRS distributions</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../england_wales/intro_results.html">Results</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../england_wales/02_lsoa_analysis_added_utility.html">Mapping outcomes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../england_wales/04_outlier_areas.html">Mapping outliers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../england_wales/03_national_mrs_dists.html">National mRS distributions</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">üëë Interactive demo</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../streamlit/streamlit.html">Streamlit app</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/samuel-book/stroke_outcome" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/outcome_model_methods/01b_excess_deaths.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Excess death rate calculations</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plain-english-summary">Plain English summary</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-sources">Data sources</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#method">Method</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#notebook-setup">Notebook setup</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#intravenous-thrombolysis">Intravenous thrombolysis</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nlvo-patients">nLVO patients</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lvo-patients">LVO patients</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mechanical-thrombectomy">Mechanical thrombectomy</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#define-functions-for-the-mt-calculations">Define functions for the MT calculations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#gather-reference-data">Gather reference data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#when-excess-deaths-are-zero-what-is-the-mortality-rate-at-285-minutes">When excess deaths are zero, what is the mortality rate at 285 minutes?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#try-various-excess-death-rates">Try various excess death rates</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#optimize-the-value-of-excess-deaths">Optimize the value of ‚Äúexcess deaths‚Äù</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#resulting-excess-death-rates">Resulting excess death rates</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="excess-death-rate-calculations">
<h1>Excess death rate calculations<a class="headerlink" href="#excess-death-rate-calculations" title="Permalink to this heading">#</a></h1>
<p>This document calculates the excess date rates associated with treatment for stroke. It calculates separate excess death rates for these three populations:</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Patient group</p></th>
<th class="head"><p>Excess death rate</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>nLVO with IVT</p></td>
<td><p><strong>1.1%</strong></p></td>
</tr>
<tr class="row-odd"><td><p>LVO with IVT</p></td>
<td><p><strong>3.4%</strong></p></td>
</tr>
<tr class="row-even"><td><p>LVO with MT</p></td>
<td><p><strong>4.0%</strong></p></td>
</tr>
</tbody>
</table>
<p>where nLVOs are non-Large Vessel Occlusions, LVOs are Large Vessel Occlusions, IVT is intravenous thrombolysis, and MT is mechanical thrombectomy.</p>
<section id="plain-english-summary">
<h2>Plain English summary<a class="headerlink" href="#plain-english-summary" title="Permalink to this heading">#</a></h2>
<p>Treating a stroke with thrombolysis or thrombectomy has the potential to remove the cause of the stroke, reduce the symptoms, and cause a better outcome after the stroke than if the patient had received no treatment. However, the treatments have the drawback of a small risk of death directly caused by the treatment.</p>
<p>We want to include this risk of death in the outcome model to make sure the results it gives are as true to life as possible.</p>
<p>To find the risk of excess death for each combination of occlusion and treatment types, we look at clinical trial data where the death rates are recorded in groups of people who received treatment and groups of people who received no treatment.</p>
</section>
<section id="data-sources">
<h2>Data sources<a class="headerlink" href="#data-sources" title="Permalink to this heading">#</a></h2>
<p>Full reference information is given at the end of this document.</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Source</p></th>
<th class="head"><p>Useful data</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Alteplase meta-analysis (Emberson et al. 2014)</p></td>
<td><p>Numbers of patients grouped by NIHSS score, whether or not they received thrombolysis, and whether or not they died.</p></td>
</tr>
<tr class="row-odd"><td><p>HERMES thrombectomy meta-analysis (Goyal et al. 2016)</p></td>
<td><p>Mortality rate with MT, average time to MT, and mRS distributions for a population of patients with LVO who did not receive thrombectomy.</p></td>
</tr>
<tr class="row-even"><td><p>Recanalisation meta-analysis (Hui et al. 2020)</p></td>
<td><p>75% rate of successful recanalisation with MT.</p></td>
</tr>
<tr class="row-odd"><td><p>SSNAP</p></td>
<td><p>Pre-stroke mRS distribution for patients with LVO.</p></td>
</tr>
</tbody>
</table>
<p>As usual we assign nLVO to patients with an NIHSS of 10 or below following the RACE scale (de la Ossa Herrero et al. 2013).</p>
</section>
<section id="method">
<h2>Method<a class="headerlink" href="#method" title="Permalink to this heading">#</a></h2>
<p>For IVT, the basic steps are:</p>
<ul class="simple">
<li><p>Calculate the death rate for the group who received thrombolysis</p></li>
<li><p>Calculate the death rate for the group who did not receive thrombolysis</p></li>
<li><p>Take the difference. This is the excess death rate.</p></li>
</ul>
<p>For MT, the method is more complicated because the same data is not available. The steps are:</p>
<ul class="simple">
<li><p>Find a reference data point where both the death rate and time to treatment are known. We use the mean time to treatment and the mortality rate from the HERMES meta-analysis (Goyal et al. 2016).</p></li>
<li><p>Define an excess death rate.</p></li>
<li><p>Apply these excess deaths uniformly to the pre-stroke and no-treatment mRS distributions.</p></li>
<li><p>Combine these mRS distributions to find the distribution for treatment at time zero and for treatment at the time of no effect.</p></li>
<li><p>Take the probability of being alive (mRS &lt; 6) in both distributions. Convert them to log-odds.</p></li>
<li><p>Assume that log-odds falls steadily with time. This follows the methodolody in the alteplase meta-analysis (Emberson et al. 2014). Calculate the log-odds at the treatment time.</p></li>
<li><p>Compare this log-odds at the treatment time with the target value.</p></li>
<li><p>Adjust the excess death rate and repeat these steps until there is no difference between the calculated and target log-odds at the treatment time.</p></li>
</ul>
</section>
<section id="notebook-setup">
<h2>Notebook setup<a class="headerlink" href="#notebook-setup" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">minimize</span>  <span class="c1"># optimise MT excess death rate</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="intravenous-thrombolysis">
<h2>Intravenous thrombolysis<a class="headerlink" href="#intravenous-thrombolysis" title="Permalink to this heading">#</a></h2>
<p><img alt="Summary image for calculating excess deaths for IVT. 1. Calculate excess deaths for nLVO patients. Table of patient numbers from Emberson et al. 2014. Excess deaths is the difference in percentages. ‚Üí Excess death is 1.1%. 2. Calculate excess deaths for LVO patients. Table of patient numbers from Emberson et al. 2014. Excess deaths is the difference in percentages. ‚Üí Excess death is 3.4%." src="../_images/data_sources_excess-death-ivt.png" /></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rows</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Number of patients&#39;</span><span class="p">,</span> <span class="s1">&#39;Deaths&#39;</span><span class="p">]</span>
<span class="n">headings</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Given IVT&#39;</span><span class="p">,</span> <span class="s1">&#39;No treatment&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<section id="nlvo-patients">
<h3>nLVO patients<a class="headerlink" href="#nlvo-patients" title="Permalink to this heading">#</a></h3>
<p>Make a copy of the data from the table:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_nlvo</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">[[</span><span class="mi">345</span><span class="p">,</span> <span class="mi">1281</span><span class="p">,</span> <span class="mi">321</span><span class="p">,</span> <span class="mi">1252</span><span class="p">],</span>
     <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">]],</span>
    <span class="n">index</span><span class="o">=</span><span class="n">rows</span><span class="p">,</span>
    <span class="n">columns</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">([</span>
        <span class="p">(</span><span class="s1">&#39;Given IVT&#39;</span><span class="p">,</span> <span class="s1">&#39;NIHSS_0-4&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Given IVT&#39;</span><span class="p">,</span> <span class="s1">&#39;NIHSS_5-10&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;No treatment&#39;</span><span class="p">,</span> <span class="s1">&#39;NIHSS_0-4&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;No treatment&#39;</span><span class="p">,</span> <span class="s1">&#39;NIHSS_5-10&#39;</span><span class="p">),</span>
    <span class="p">])</span>
<span class="p">)</span>

<span class="c1"># Sum the NIHSS 0-4 and NIHSS 5-10 columns to find NIHSS 0-10:</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">head</span> <span class="ow">in</span> <span class="n">headings</span><span class="p">:</span>
        <span class="n">df_nlvo</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="p">(</span><span class="n">head</span><span class="p">,</span> <span class="s1">&#39;NIHSS_0-10&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">df_nlvo</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="p">[(</span><span class="n">head</span><span class="p">,</span> <span class="s1">&#39;NIHSS_0-4&#39;</span><span class="p">),</span> <span class="p">(</span><span class="n">head</span><span class="p">,</span> <span class="s1">&#39;NIHSS_5-10&#39;</span><span class="p">)]]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>

<span class="c1"># Sort the columns:</span>
<span class="n">df_nlvo</span> <span class="o">=</span> <span class="n">df_nlvo</span><span class="p">[</span><span class="n">headings</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_nlvo</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="3" halign="left">Given IVT</th>
      <th colspan="3" halign="left">No treatment</th>
    </tr>
    <tr>
      <th></th>
      <th>NIHSS_0-4</th>
      <th>NIHSS_5-10</th>
      <th>NIHSS_0-10</th>
      <th>NIHSS_0-4</th>
      <th>NIHSS_5-10</th>
      <th>NIHSS_0-10</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Number of patients</th>
      <td>345</td>
      <td>1281</td>
      <td>1626.0</td>
      <td>321</td>
      <td>1252</td>
      <td>1573.0</td>
    </tr>
    <tr>
      <th>Deaths</th>
      <td>3</td>
      <td>20</td>
      <td>23.0</td>
      <td>0</td>
      <td>5</td>
      <td>5.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Calculate the death rates from the table:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">percdeath_nlvo_givenivt</span> <span class="o">=</span> <span class="mf">100.0</span> <span class="o">*</span> <span class="p">(</span>
    <span class="n">df_nlvo</span><span class="p">[</span><span class="s1">&#39;Given IVT&#39;</span><span class="p">][</span><span class="s1">&#39;NIHSS_0-10&#39;</span><span class="p">][</span><span class="s1">&#39;Deaths&#39;</span><span class="p">]</span> <span class="o">/</span>
    <span class="n">df_nlvo</span><span class="p">[</span><span class="s1">&#39;Given IVT&#39;</span><span class="p">][</span><span class="s1">&#39;NIHSS_0-10&#39;</span><span class="p">][</span><span class="s1">&#39;Number of patients&#39;</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">percdeath_nlvo_notreat</span> <span class="o">=</span> <span class="mf">100.0</span> <span class="o">*</span> <span class="p">(</span>
    <span class="n">df_nlvo</span><span class="p">[</span><span class="s1">&#39;No treatment&#39;</span><span class="p">][</span><span class="s1">&#39;NIHSS_0-10&#39;</span><span class="p">][</span><span class="s1">&#39;Deaths&#39;</span><span class="p">]</span> <span class="o">/</span>
    <span class="n">df_nlvo</span><span class="p">[</span><span class="s1">&#39;No treatment&#39;</span><span class="p">][</span><span class="s1">&#39;NIHSS_0-10&#39;</span><span class="p">][</span><span class="s1">&#39;Number of patients&#39;</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">excess_deaths_nlvo</span> <span class="o">=</span> <span class="n">percdeath_nlvo_givenivt</span> <span class="o">-</span> <span class="n">percdeath_nlvo_notreat</span>
</pre></div>
</div>
</div>
</div>
<p>Show the excess death rate:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Death rate for &quot;Given IVT&quot;:    </span><span class="si">{</span><span class="n">percdeath_nlvo_givenivt</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">%&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Death rate for &quot;No treatment&quot;: </span><span class="si">{</span><span class="n">percdeath_nlvo_notreat</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">%&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Excess death rate:             </span><span class="si">{</span><span class="n">excess_deaths_nlvo</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">%&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Death rate for &quot;Given IVT&quot;:    1.415%
Death rate for &quot;No treatment&quot;: 0.318%
Excess death rate:             1.097%
</pre></div>
</div>
</div>
</div>
</section>
<section id="lvo-patients">
<h3>LVO patients<a class="headerlink" href="#lvo-patients" title="Permalink to this heading">#</a></h3>
<p>Repeat the same method as for nLVO patients.</p>
<p>Make a copy of the data from the table:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_lvo</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">[[</span><span class="mi">794</span><span class="p">,</span> <span class="mi">662</span><span class="p">,</span> <span class="mi">309</span><span class="p">,</span> <span class="mi">808</span><span class="p">,</span> <span class="mi">671</span><span class="p">,</span> <span class="mi">313</span><span class="p">],</span>
     <span class="p">[</span><span class="mi">23</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">]],</span>
    <span class="n">index</span><span class="o">=</span><span class="n">rows</span><span class="p">,</span>
    <span class="n">columns</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">([</span>
        <span class="p">(</span><span class="s1">&#39;Given IVT&#39;</span><span class="p">,</span> <span class="s1">&#39;NIHSS_11-15&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Given IVT&#39;</span><span class="p">,</span> <span class="s1">&#39;NIHSS_16-21&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Given IVT&#39;</span><span class="p">,</span> <span class="s1">&#39;NIHSS_&gt;=22&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;No treatment&#39;</span><span class="p">,</span> <span class="s1">&#39;NIHSS_11-15&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;No treatment&#39;</span><span class="p">,</span> <span class="s1">&#39;NIHSS_16-21&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;No treatment&#39;</span><span class="p">,</span> <span class="s1">&#39;NIHSS_&gt;=22&#39;</span><span class="p">),</span>
    <span class="p">])</span>
<span class="p">)</span>

<span class="c1"># Sum the NIHSS 11-15, NIHSS 16-21 and NIHSS &gt;=22 columns to find NIHSS &gt;=11:</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">head</span> <span class="ow">in</span> <span class="n">headings</span><span class="p">:</span>
        <span class="n">df_lvo</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="p">(</span><span class="n">head</span><span class="p">,</span> <span class="s1">&#39;NIHSS_&gt;=11&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">df_lvo</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="p">[(</span><span class="n">head</span><span class="p">,</span> <span class="s1">&#39;NIHSS_11-15&#39;</span><span class="p">),</span> <span class="p">(</span><span class="n">head</span><span class="p">,</span> <span class="s1">&#39;NIHSS_16-21&#39;</span><span class="p">),</span> <span class="p">(</span><span class="n">head</span><span class="p">,</span> <span class="s1">&#39;NIHSS_&gt;=22&#39;</span><span class="p">)]]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>

<span class="c1"># Sort the columns:</span>
<span class="n">df_lvo</span> <span class="o">=</span> <span class="n">df_lvo</span><span class="p">[</span><span class="n">headings</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_lvo</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="4" halign="left">Given IVT</th>
      <th colspan="4" halign="left">No treatment</th>
    </tr>
    <tr>
      <th></th>
      <th>NIHSS_11-15</th>
      <th>NIHSS_16-21</th>
      <th>NIHSS_&gt;=22</th>
      <th>NIHSS_&gt;=11</th>
      <th>NIHSS_11-15</th>
      <th>NIHSS_16-21</th>
      <th>NIHSS_&gt;=22</th>
      <th>NIHSS_&gt;=11</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Number of patients</th>
      <td>794</td>
      <td>662</td>
      <td>309</td>
      <td>1765.0</td>
      <td>808</td>
      <td>671</td>
      <td>313</td>
      <td>1792.0</td>
    </tr>
    <tr>
      <th>Deaths</th>
      <td>23</td>
      <td>24</td>
      <td>21</td>
      <td>68.0</td>
      <td>1</td>
      <td>5</td>
      <td>2</td>
      <td>8.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Calculate the death rates from the table:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">percdeath_lvo_givenivt</span> <span class="o">=</span> <span class="mf">100.0</span> <span class="o">*</span> <span class="p">(</span>
    <span class="n">df_lvo</span><span class="p">[</span><span class="s1">&#39;Given IVT&#39;</span><span class="p">][</span><span class="s1">&#39;NIHSS_&gt;=11&#39;</span><span class="p">][</span><span class="s1">&#39;Deaths&#39;</span><span class="p">]</span> <span class="o">/</span>
    <span class="n">df_lvo</span><span class="p">[</span><span class="s1">&#39;Given IVT&#39;</span><span class="p">][</span><span class="s1">&#39;NIHSS_&gt;=11&#39;</span><span class="p">][</span><span class="s1">&#39;Number of patients&#39;</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">percdeath_lvo_notreat</span> <span class="o">=</span> <span class="mf">100.0</span> <span class="o">*</span> <span class="p">(</span>
    <span class="n">df_lvo</span><span class="p">[</span><span class="s1">&#39;No treatment&#39;</span><span class="p">][</span><span class="s1">&#39;NIHSS_&gt;=11&#39;</span><span class="p">][</span><span class="s1">&#39;Deaths&#39;</span><span class="p">]</span> <span class="o">/</span>
    <span class="n">df_lvo</span><span class="p">[</span><span class="s1">&#39;No treatment&#39;</span><span class="p">][</span><span class="s1">&#39;NIHSS_&gt;=11&#39;</span><span class="p">][</span><span class="s1">&#39;Number of patients&#39;</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">excess_deaths_lvo</span> <span class="o">=</span> <span class="n">percdeath_lvo_givenivt</span> <span class="o">-</span> <span class="n">percdeath_lvo_notreat</span>
</pre></div>
</div>
</div>
</div>
<p>Show the excess death rate:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Death rate for &quot;Given IVT&quot;:    </span><span class="si">{</span><span class="n">percdeath_lvo_givenivt</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">%&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Death rate for &quot;No treatment&quot;: </span><span class="si">{</span><span class="n">percdeath_lvo_notreat</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">%&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Excess death rate:             </span><span class="si">{</span><span class="n">excess_deaths_lvo</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">%&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Death rate for &quot;Given IVT&quot;:    3.853%
Death rate for &quot;No treatment&quot;: 0.446%
Excess death rate:             3.406%
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="mechanical-thrombectomy">
<h2>Mechanical thrombectomy<a class="headerlink" href="#mechanical-thrombectomy" title="Permalink to this heading">#</a></h2>
<p><img alt="Summary image for calculating excess deaths from MT. 1. Find reference data point. The average MT treatment time is 285 minutes and the death rate of patients given MT is 15.3%. This gives a probability that mRS is less than 6 of 84.7%. Convert this probability to log-odds. The log-odds of mRS being less than 6 when MT is given at 285 minutes is 1.709. ‚Üí log-odds reference = 1.709. 2. Define time-zero distribution. Calculate two distributions: Full-effect data: pre-stroke data with excess deaths. No-effect data: no-treatment data with excess deaths. Combine 75% of the full-effect data with 25% of the no-effect data to make the time-zero data. 3. Method for finding excess deaths: Set the excess death value e.As above, use these excess deaths to calculate: The full-effect data, The no-effect-time data, The time-zero data. Take the probability that mRS is less than 6 in the time-zero and the no-effect-time distributions. Convert the probabilities to log-odds. Plot the two log-odds values and treatment times and connect the points with a straight line. How close is the straight line to the reference point? These steps can be repeated with different values of excess death e until the line passes exactly through the reference data point. Using an optimiser function, we find the best e=4.00%. ‚Üí Excess death is 4.0%." src="../_images/data_sources_excess-death-mt.png" /></p>
<section id="define-functions-for-the-mt-calculations">
<h3>Define functions for the MT calculations<a class="headerlink" href="#define-functions-for-the-mt-calculations" title="Permalink to this heading">#</a></h3>
<p>The following functions convert one or more values from probability into log-odds and back:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">convert_prob_to_logodds</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">p</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">p</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">convert_logodds_to_prob</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">l</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>The following two functions are defined because the calculations will be needed very many times to fine-tune the value of excess death rate.</p>
<p>The following function adjusts the probabilities for pre-stroke and no-treatment populations by accounting for excess deaths:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">calculate_logodds_with_excess_deaths</span><span class="p">(</span><span class="n">p_pre</span><span class="p">,</span> <span class="n">p_not</span><span class="p">,</span> <span class="n">ed</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find logodds at time zero and time of no effect.</span>

<span class="sd">    Add the excess deaths into the pre-stroke and no-treatment</span>
<span class="sd">    distributions. Then calculate a weighted sum of the two dists.</span>
<span class="sd">    Convert the resulting probabilities to log-odds.</span>

<span class="sd">    Inputs</span>
<span class="sd">    ------</span>
<span class="sd">    p_pre - float or np.array. Pre-stroke probability.</span>
<span class="sd">    p_not - float or np.array. No-treatment probability.</span>
<span class="sd">    ed    - float. Excess death rate.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    l_t0  - float or np.array. Log-odds at time zero.</span>
<span class="sd">    l_tne - float or np.array. Log-odds at no-effect time.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Weight pre-stroke probability by excess deaths:</span>
    <span class="n">p_pre_deaths</span> <span class="o">=</span> <span class="n">p_pre</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">ed</span><span class="p">)</span>
    <span class="c1"># Weight no-treatment probability by excess deaths:</span>
    <span class="n">p_tne</span> <span class="o">=</span> <span class="n">p_not</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">ed</span><span class="p">)</span>
    <span class="c1"># Calculate new time-zero-treatment probability by</span>
    <span class="c1"># combining the new pre-stroke and no-treatment probs:</span>
    <span class="n">p_t0</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.75</span> <span class="o">*</span> <span class="n">p_pre_deaths</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mf">0.25</span> <span class="o">*</span> <span class="n">p_tne</span><span class="p">)</span>
    
    <span class="c1"># Convert time-zero and time-of-no-effect probs to logodds:</span>
    <span class="n">l_t0</span> <span class="o">=</span> <span class="n">convert_prob_to_logodds</span><span class="p">(</span><span class="n">p_t0</span><span class="p">)</span>
    <span class="n">l_tne</span> <span class="o">=</span> <span class="n">convert_prob_to_logodds</span><span class="p">(</span><span class="n">p_tne</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">l_t0</span><span class="p">,</span> <span class="n">l_tne</span>
</pre></div>
</div>
</div>
</div>
<p>The following function first uses the previous function to find the probabilities for treatment at time zero and at the time of no effect. It then uses those end points to find the log-odds at the target treatment time.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">calculate_logodds_t_target</span><span class="p">(</span><span class="n">ed</span><span class="p">,</span> <span class="n">p_pre</span><span class="p">,</span> <span class="n">p_not</span><span class="p">,</span> <span class="n">tne</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">t_target</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate logodds at target time from scratch.</span>

<span class="sd">    Find the log-odds for treatment at time zero and at the time of</span>
<span class="sd">    no-effect. Connect the two points with a straight line. Find</span>
<span class="sd">    the value of log(odds) along this line at the target time.</span>
<span class="sd">    </span>
<span class="sd">               ^</span>
<span class="sd">               |  (t0, l_t0)</span>
<span class="sd">               | x__</span>
<span class="sd">    log(odds)  |    \__</span>
<span class="sd">               |       \__   (tne, l_tne)</span>
<span class="sd">               |          \_x     </span>
<span class="sd">               +------------------&gt;</span>
<span class="sd">                     Time</span>

<span class="sd">    Inputs</span>
<span class="sd">    ------</span>
<span class="sd">    ed       - float. Excess death rate.</span>
<span class="sd">    p_pre    - float or np.array. Pre-stroke probability.</span>
<span class="sd">    p_not    - float or np.array. No-treatment probability.</span>
<span class="sd">    t_ne     - float. Time of no effect.</span>
<span class="sd">    t0       - float. Time zero.</span>
<span class="sd">    t_target - float. Target treatment time.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    l_t_target - float or np.array. Log-odds at target treatment time.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># First add excess deaths into the pre-stroke and no-treatment</span>
    <span class="c1"># probabilities. Take their weighted sum to find the time-zero</span>
    <span class="c1"># probabilities. Convert the time-zero treatment and no-effect</span>
    <span class="c1"># probabilities into log-odds.</span>
    <span class="n">l_t0</span><span class="p">,</span> <span class="n">l_tne</span> <span class="o">=</span> <span class="n">calculate_logodds_with_excess_deaths</span><span class="p">(</span><span class="n">p_pre</span><span class="p">,</span> <span class="n">p_not</span><span class="p">,</span> <span class="n">ed</span><span class="p">)</span>

    <span class="c1"># Treat the two log-odds values as two points to be connected</span>
    <span class="c1"># with a straight line. Find an equation for the line based on</span>
    <span class="c1"># its slope and y-intercept.</span>
    <span class="n">slope</span> <span class="o">=</span> <span class="p">(</span><span class="n">l_tne</span> <span class="o">-</span> <span class="n">l_t0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">tne</span> <span class="o">-</span> <span class="n">t0</span><span class="p">)</span>
    <span class="n">y_intercept</span> <span class="o">=</span> <span class="n">l_t0</span>

    <span class="c1"># Use this line equation to find the log-odds at the chosen</span>
    <span class="c1"># treatment time.</span>
    <span class="n">l_t_target</span> <span class="o">=</span> <span class="p">(</span><span class="n">slope</span> <span class="o">*</span> <span class="n">t_target</span><span class="p">)</span> <span class="o">+</span> <span class="n">y_intercept</span>
    <span class="k">return</span> <span class="n">l_t_target</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="gather-reference-data">
<h3>Gather reference data<a class="headerlink" href="#gather-reference-data" title="Permalink to this heading">#</a></h3>
<p>Define times in hours:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t0</span> <span class="o">=</span> <span class="mf">0.0</span>   <span class="c1"># time zero</span>
<span class="n">tne</span> <span class="o">=</span> <span class="mf">8.0</span>  <span class="c1"># time of no effect</span>
<span class="c1"># Average MT treatment time:</span>
<span class="n">t_target</span> <span class="o">=</span> <span class="p">(</span><span class="mf">285.0</span> <span class="o">/</span> <span class="mf">60.0</span><span class="p">)</span>  <span class="c1"># from the treatment time table.</span>
</pre></div>
</div>
</div>
</div>
<p>Gather the probabilities of being alive (mRS less than 6) in the pre-stroke and no-treatment distributions:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Store mRS dists in this dictionary:</span>
<span class="n">mrs_dists</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">mrs_dists</span><span class="p">[</span><span class="s1">&#39;pre_stroke_lvo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.4179</span><span class="p">,</span> <span class="mf">0.1430</span><span class="p">,</span> <span class="mf">0.1184</span><span class="p">,</span> <span class="mf">0.1642</span><span class="p">,</span> <span class="mf">0.1138</span><span class="p">,</span> <span class="mf">0.0427</span><span class="p">,</span> <span class="mf">0.0000</span><span class="p">])</span>
<span class="n">mrs_dists</span><span class="p">[</span><span class="s1">&#39;no_treatment_lvo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0500</span><span class="p">,</span> <span class="mf">0.0790</span><span class="p">,</span> <span class="mf">0.1360</span><span class="p">,</span> <span class="mf">0.1640</span><span class="p">,</span> <span class="mf">0.2470</span><span class="p">,</span> <span class="mf">0.1350</span><span class="p">,</span> <span class="mf">0.1890</span><span class="p">])</span>

<span class="c1"># Convert the mRS distributions to cumulative mRS distributions:</span>
<span class="n">mrs_dists_cumsum</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">mrs_dists</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">mrs_dists</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
    <span class="n">mrs_dists_cumsum</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">mrs_dists</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

<span class="c1"># Probabilities of mRS &lt; 6 in pre-stroke and no-treatment distributions:</span>
<span class="n">p_pre</span> <span class="o">=</span> <span class="n">mrs_dists_cumsum</span><span class="p">[</span><span class="s1">&#39;pre_stroke_lvo&#39;</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span>
<span class="n">p_not</span> <span class="o">=</span> <span class="n">mrs_dists_cumsum</span><span class="p">[</span><span class="s1">&#39;no_treatment_lvo&#39;</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Probability of mRS &lt; 6 for pre-stroke:   </span><span class="si">{</span><span class="n">p_pre</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Probability of mRS &lt; 6 for no-treatment: </span><span class="si">{</span><span class="n">p_not</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Probability of mRS &lt; 6 for pre-stroke:   1.0
Probability of mRS &lt; 6 for no-treatment: 0.811
</pre></div>
</div>
</div>
</div>
<p>Target probability of being alive (mRS less than 6) at average MT treatment time:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Probability of death:</span>
<span class="n">p_death_mt</span> <span class="o">=</span> <span class="mf">97.0</span> <span class="o">/</span> <span class="mf">633.0</span>  <span class="c1"># from the mortality rate table.</span>

<span class="c1"># Flip this for probability of being alive:</span>
<span class="n">p_target</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">p_death_mt</span>
</pre></div>
</div>
</div>
</div>
<p>Check that the target probability is between the starting and ending probabilities:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p_pre</span><span class="p">,</span> <span class="n">p_not</span><span class="p">,</span> <span class="n">p_target</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1.0, 0.811, 0.8467614533965244)
</pre></div>
</div>
</div>
</div>
<p>Convert the target probability into log-odds at the average MT treatment time:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">l_target</span> <span class="o">=</span> <span class="n">convert_prob_to_logodds</span><span class="p">(</span><span class="n">p_target</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">l_target</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.7094231825674187
</pre></div>
</div>
</div>
</div>
<p>Check that the target log-odds is correct by converting it back to probability. The result of the following function should match <code class="docutils literal notranslate"><span class="pre">p_target</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">convert_logodds_to_prob</span><span class="p">(</span><span class="n">l_target</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.8467614533965244
</pre></div>
</div>
</div>
</div>
</section>
<section id="when-excess-deaths-are-zero-what-is-the-mortality-rate-at-285-minutes">
<h3>When excess deaths are zero, what is the mortality rate at 285 minutes?<a class="headerlink" href="#when-excess-deaths-are-zero-what-is-the-mortality-rate-at-285-minutes" title="Permalink to this heading">#</a></h3>
<p>Expect this value to be a bit lower than the target 15.3% from the paper.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">l_target_ed0</span> <span class="o">=</span> <span class="n">calculate_logodds_t_target</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">p_pre</span><span class="p">,</span> <span class="n">p_not</span><span class="p">,</span> <span class="n">tne</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">t_target</span><span class="p">)</span>
<span class="n">p_target_ed0</span> <span class="o">=</span> <span class="n">convert_logodds_to_prob</span><span class="p">(</span><span class="n">l_target_ed0</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Mortality at </span><span class="si">{</span><span class="n">t_target</span><span class="si">}</span><span class="s1"> hours: </span><span class="si">{</span><span class="mf">1.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">p_target_ed0</span><span class="si">:</span><span class="s1">.2%</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mortality at 4.75 hours: 11.05%
</pre></div>
</div>
</div>
</div>
</section>
<section id="try-various-excess-death-rates">
<h3>Try various excess death rates<a class="headerlink" href="#try-various-excess-death-rates" title="Permalink to this heading">#</a></h3>
<p>Calculate the straight-line fit for various excess death rates and plot them as we go along.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># First mark the target log-odds at the treatment time:</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">t_target</span><span class="p">,</span> <span class="n">l_target</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Target&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">ed</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.00</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">):</span>
    <span class="c1"># Find endpoints of the straight line for this excess deaths value:</span>
    <span class="n">l_t0</span><span class="p">,</span> <span class="n">l_tne</span> <span class="o">=</span> <span class="n">calculate_logodds_with_excess_deaths</span><span class="p">(</span><span class="n">p_pre</span><span class="p">,</span> <span class="n">p_not</span><span class="p">,</span> <span class="n">ed</span><span class="p">)</span>
    <span class="c1"># Plot the straight line fit:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="p">[</span><span class="n">t0</span><span class="p">,</span> <span class="n">tne</span><span class="p">],</span>
        <span class="p">[</span><span class="n">l_t0</span><span class="p">,</span> <span class="n">l_tne</span><span class="p">],</span>
        <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ed</span><span class="si">:</span><span class="s1">.2%</span><span class="si">}</span><span class="s1"> excess deaths&#39;</span>
    <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;log(odds)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time (hours)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/03a9c4e51702e1c22dcf26a175912b47ba86eee0ec0b10b87755b9a62268fb3e.png" src="../_images/03a9c4e51702e1c22dcf26a175912b47ba86eee0ec0b10b87755b9a62268fb3e.png" />
</div>
</div>
</section>
<section id="optimize-the-value-of-excess-deaths">
<h3>Optimize the value of ‚Äúexcess deaths‚Äù<a class="headerlink" href="#optimize-the-value-of-excess-deaths" title="Permalink to this heading">#</a></h3>
<p>Find the best value of ‚Äúexcess deaths‚Äù by using an optimiser function to try lots of different values. The ‚Äúbest‚Äù value is the one that gives the smallest difference between the target and the calculated log-odds at the treatment time. The optimiser will keep adjusting the value until the difference is as small as possible.</p>
<p>This function returns the difference between the calculated value and the target:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">calculate_difference_logodds_t_target</span><span class="p">(</span><span class="n">ed</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate log-odds and find difference from target value.&quot;&quot;&quot;</span>
    <span class="n">l_t_target</span> <span class="o">=</span> <span class="n">calculate_logodds_t_target</span><span class="p">(</span><span class="n">ed</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">l_t_target</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span>
    <span class="n">calculate_difference_logodds_t_target</span><span class="p">,</span>  <span class="c1"># Result from this func.</span>
    <span class="mf">0.03</span><span class="p">,</span>                                   <span class="c1"># Initial guess.</span>
    <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">l_target</span><span class="p">,</span> <span class="n">p_pre</span><span class="p">,</span> <span class="n">p_not</span><span class="p">,</span> <span class="n">tne</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">t_target</span><span class="p">],</span>  <span class="c1"># Constants.</span>
    <span class="n">method</span><span class="o">=</span><span class="s1">&#39;Nelder-Mead&#39;</span>                    <span class="c1"># Good when abs() in func.</span>
<span class="p">)</span>

<span class="c1"># Save the optimized excess deaths value:</span>
<span class="n">ed_opt</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># View full results:</span>
<span class="n">results</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>       message: Optimization terminated successfully.
       success: True
        status: 0
           fun: 0.00033718804324145424
             x: [ 4.003e-02]
           nit: 9
          nfev: 18
 final_simplex: (array([[ 4.003e-02],
                       [ 4.013e-02]]), array([ 3.372e-04,  3.890e-04]))
</pre></div>
</div>
</div>
</div>
<p>Resulting excess deaths value:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ed_opt</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.040031250000000004
</pre></div>
</div>
</div>
</div>
<p>Check that this excess death value is sensible by plotting its straight line fit:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">t_target</span><span class="p">,</span> <span class="n">l_target</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Target&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">e</span><span class="p">,</span> <span class="n">ed</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="mf">0.00</span><span class="p">,</span> <span class="n">ed_opt</span><span class="p">]):</span>
    <span class="n">l_t0</span><span class="p">,</span> <span class="n">l_tne</span> <span class="o">=</span> <span class="n">calculate_logodds_with_excess_deaths</span><span class="p">(</span><span class="n">p_pre</span><span class="p">,</span> <span class="n">p_not</span><span class="p">,</span> <span class="n">ed</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="p">[</span><span class="n">t0</span><span class="p">,</span> <span class="n">tne</span><span class="p">],</span>
        <span class="p">[</span><span class="n">l_t0</span><span class="p">,</span> <span class="n">l_tne</span><span class="p">],</span>
        <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ed</span><span class="si">:</span><span class="s1">.2%</span><span class="si">}</span><span class="s1"> excess deaths&#39;</span><span class="p">,</span>
        <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;log(odds)</span><span class="se">\n</span><span class="s1">of &quot;mRS &lt; 6&quot;</span><span class="se">\n</span><span class="s1">given MT&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time (hours)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;./images/excess_deaths_mt_fit.png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/5634ea3a3ef7f18819aa01a88116b3b62edd9738d5b4d00c1a683868c54e88d8.png" src="../_images/5634ea3a3ef7f18819aa01a88116b3b62edd9738d5b4d00c1a683868c54e88d8.png" />
</div>
</div>
</section>
</section>
<section id="resulting-excess-death-rates">
<h2>Resulting excess death rates<a class="headerlink" href="#resulting-excess-death-rates" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;nLVO with IVT: </span><span class="si">{</span><span class="n">excess_deaths_nlvo</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">%&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;LVO with IVT:  </span><span class="si">{</span><span class="n">excess_deaths_lvo</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">%&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;LVO with MT:   </span><span class="si">{</span><span class="mf">100.0</span><span class="o">*</span><span class="n">ed_opt</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">%&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>nLVO with IVT: 1.097%
LVO with IVT:  3.406%
LVO with MT:   4.003%
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./outcome_model_methods"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="01_mrs_dist_derivation.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Derivation of mRS distributions from reference data</p>
      </div>
    </a>
    <a class="right-next"
       href="01c_extrapolate_time_zero.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Extrapolating a known odds ratio back to time zero</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plain-english-summary">Plain English summary</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-sources">Data sources</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#method">Method</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#notebook-setup">Notebook setup</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#intravenous-thrombolysis">Intravenous thrombolysis</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nlvo-patients">nLVO patients</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lvo-patients">LVO patients</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mechanical-thrombectomy">Mechanical thrombectomy</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#define-functions-for-the-mt-calculations">Define functions for the MT calculations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#gather-reference-data">Gather reference data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#when-excess-deaths-are-zero-what-is-the-mortality-rate-at-285-minutes">When excess deaths are zero, what is the mortality rate at 285 minutes?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#try-various-excess-death-rates">Try various excess death rates</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#optimize-the-value-of-excess-deaths">Optimize the value of ‚Äúexcess deaths‚Äù</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#resulting-excess-death-rates">Resulting excess death rates</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Anna Laws, Kerry Pearn, Michael Allen, Peter McMeekin, and Martin James
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      ¬© Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=c5ced968eda925caa686"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=c5ced968eda925caa686"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>